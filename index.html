<!DOCTYPE html>
<html lang="sl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TV Arhiv - Radio Marija</title>
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
/>
<style>
  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    background: #f4f6fb;
    color: #333;
  }
  header,
  footer {
    background: #2e3a59;
    color: white;
    padding: 10px 20px;
  }
  header {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  header img {
    height: 40px;
  }
  nav a {
    color: white;
    margin-left: 15px;
    text-decoration: none;
    font-weight: bold;
    cursor: pointer;
  }
  .content {
    padding: 30px;
    display: none;
  }
  table {
    width: 100%;
    background: white;
    border-collapse: collapse;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
  }
  th,
  td {
    padding: 12px 15px;
    border: 1px solid #e0e0e0;
    vertical-align: middle;
  }
  th {
    background: #f0f2f7;
    text-align: left;
  }
  button,
  .icon-button {
    background: #2e77d0;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    margin-top: 20px;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    font-size: 1rem;
  }
  .icon-button {
    padding: 6px 10px;
    font-weight: normal;
    border-radius: 5px;
  }
  .icon-button:hover,
  button:hover {
    background: #255ea8;
  }
  footer {
    text-align: center;
    position: fixed;
    bottom: 0;
    width: 100%;
  }
  .modal,
  .login-screen {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 10;
  }
  .modal-content,
  .login-box {
    background: white;
    padding: 25px 30px;
    border-radius: 10px;
    width: 95%;
    max-width: 500px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    position: relative;
    font-size: 1rem;
  }
  .login-box img {
    display: block;
    margin: 0 auto 20px;
    max-width: 80%;
  }
  .login-box input,
  .modal-content input,
  .modal-content select {
    width: 100%;
    padding: 10px;
    margin-bottom: 15px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 1rem;
  }
  .close {
    position: absolute;
    top: 10px;
    right: 15px;
    font-size: 22px;
    cursor: pointer;
    color: #aaa;
    transition: color 0.2s;
  }
  .close:hover {
    color: black;
  }
  label.status-label {
    font-weight: 600;
    margin-top: 10px;
    display: block;
    margin-bottom: 5px;
  }
  #file-info {
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: #f0f2f7;
    padding: 8px 12px;
    border-radius: 6px;
    margin-bottom: 15px;
    font-size: 0.9rem;
  }
  #file-info span {
    overflow-wrap: anywhere;
  }
  #remove-file-btn {
    background: none;
    border: none;
    color: #d9534f;
    cursor: pointer;
    font-size: 1.3rem;
  }
  #remove-file-btn:hover {
    color: #a12b24;
  }
  a.scenarij-link {
    color: #2e77d0;
    cursor: pointer;
    text-decoration: underline;
  }
  a.scenarij-link:hover {
    color: #255ea8;
  }
  /* Table delete icon in table now removed as per spec */
</style>
</head>
<body>
<header>
  <img src="RMS.png" alt="RMS Logo" />
  <nav>
    <a onclick="prikaziDomov()">DOMOV</a>
    <a onclick="prikaziArhiv()">ARHIV</a>
    <a onclick="odjava()">ODJAVA</a>
  </nav>
</header>

<div class="content" id="domov">
  <div style="text-align:center;">
    <img src="RMS.png" alt="Logo" style="max-width: 300px;" />
  </div>
</div>

<div class="content" id="arhiv">
  <h2>Arhiv scenarijev</h2>
  <button class="icon-button" onclick="odpriModal()">
    <i class="fa fa-plus"></i> Dodaj scenarij
  </button>
  <table id="tabela">
    <thead>
      <tr>
        <th>Datum</th>
        <th>Naslov</th>
        <th>Tip</th>
        <th>Jezik</th>
        <th>Stanje</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<footer>© Radio Marija Slovenija, 2025</footer>

<!-- Modal za dodajanje scenarija -->
<div id="modal" class="modal" style="display: none;">
  <div class="modal-content">
    <span class="close" onclick="zapriModal()">&times;</span>
    <h3>Dodaj nov scenarij</h3>
    <input type="date" id="datum" />
    <input type="text" id="naslov" placeholder="Naslov oddaje" maxlength="100" />
    <select id="tip">
      <option value="Prevod">Prevod</option>
      <option value="Podnapisi">Podnapisi</option>
      <option value="Voice-over">Voice-over</option>
    </select>
    <input type="text" id="jezik" placeholder="Jezik" maxlength="50" />
    <label class="status-label" for="stanje">Stanje scenarija</label>
    <select id="stanje">
      <option value="PREVEDENO">PREVEDENO</option>
      <option value="POSNETO">POSNETO</option>
      <option value="UREJENO">UREJENO</option>
      <option value="OBJAVLJENO">OBJAVLJENO</option>
    </select>

    <label class="status-label">Naloži Word datoteko (.doc, .docx)</label>
    <input
      type="file"
      id="scenarijFile"
      accept=".doc,.docx"
      onchange="handleFileSelect()"
    />
    <div id="file-info" style="display:none;">
      <span id="file-name"></span>
      <button id="remove-file-btn" title="Odstrani datoteko" onclick="odstraniDatoteko()">
        <i class="fa fa-trash"></i>
      </button>
    </div>

    <button onclick="shraniScenarij()">Shrani scenarij</button>
  </div>
</div>

<!-- Modal za podrobnosti scenarija -->
<div id="podrobnostiModal" class="modal" style="display:none;">
  <div class="modal-content">
    <span class="close" onclick="zapriPodrobnostiModal()">&times;</span>
    <h3 id="podrobnostiNaslov"></h3>
    <p><strong>Datum:</strong> <span id="podrobnostiDatum"></span></p>
    <p><strong>Tip:</strong> <span id="podrobnostiTip"></span></p>
    <p><strong>Jezik:</strong> <span id="podrobnostiJezik"></span></p>
    <p><strong>Stanje:</strong> <span id="podrobnostiStanje"></span></p>
    <p><strong>Dodano od:</strong> <span id="podrobnostiAvtor"></span></p>
    <p>
      <strong>Datoteka:</strong>
      <a href="#" target="_blank" id="podrobnostiLink" class="scenarij-link"
        >Prenesi / Odpri</a
      >
    </p>
  </div>
</div>

<!-- Login ekran -->
<div class="login-screen" id="login">
  <div class="login-box">
    <img src="RMS.png" alt="RMS" />
    <h3 style="text-align:center;">Prijava</h3>
    <input
      type="text"
      id="uporabniskoIme"
      placeholder="Uporabniško ime (npr. neja)"
      autocomplete="off"
      maxlength="20"
    />
    <input
      type="password"
      id="geslo"
      placeholder="Geslo"
      autocomplete="off"
      maxlength="20"
    />
    <button onclick="prijava()">
      <i class="fa fa-right-to-bracket"></i> Prijavi se
    </button>
  </div>
</div>

<script>
  const dovoljeni = {
    jasa: { ime: "Jaša Petrinjak", geslo: "jasapass" },
    neja: { ime: "Neja Stvarnik", geslo: "nejapass" },
    julija: { ime: "Julija Brilej", geslo: "julijapass" },
  };

  let prijavljen = null;
  let izbranaDatoteka = null;

  function prijava() {
    const uporabnik = document
      .getElementById("uporabniskoIme")
      .value.toLowerCase()
      .trim();
    const geslo = document.getElementById("geslo").value;

    if (
      dovoljeni[uporabnik] &&
      dovoljeni[uporabnik].geslo === geslo &&
      dovoljeni[uporabnik].ime
    ) {
      prijavljen = dovoljeni[uporabnik].ime;
      localStorage.setItem("prijavljen", prijavljen);
      document.getElementById("login").style.display = "none";
      document.getElementById("domov").style.display = "block";
      ocistiLoginFormo();
    } else {
      alert("Neveljavno uporabniško ime ali geslo.");
    }
  }

  function ocistiLoginFormo() {
    document.getElementById("uporabniskoIme").value = "";
    document.getElementById("geslo").value = "";
  }

  function odjava() {
    localStorage.removeItem("prijavljen");
    location.reload();
  }

  function odpriModal() {
    document.getElementById("modal").style.display = "flex";
  }

  function zapriModal() {
    document.getElementById("modal").style.display = "none";
    resetirajModal();
  }

  function resetirajModal() {
    document.getElementById("datum").value = "";
    document.getElementById("naslov").value = "";
    document.getElementById("tip").value = "Prevod";
    document.getElementById("jezik").value = "";
    document.getElementById("stanje").value = "PREVEDENO";
    document.getElementById("scenarijFile").value = "";
    izbranaDatoteka = null;
    document.getElementById("file-info").style.display = "none";
  }

  function handleFileSelect() {
    const input = document.getElementById("scenarijFile");
    if (input.files.length > 0) {
      izbranaDatoteka = input.files[0];
      document.getElementById("file-name").textContent = izbranaDatoteka.name;
      document.getElementById("file-info").style.display = "flex";
    } else {
      izbranaDatoteka = null;
      document.getElementById("file-info").style.display = "none";
    }
  }

  function odstraniDatoteko() {
    izbranaDatoteka = null;
    const input = document.getElementById("scenarijFile");
    input.value = "";
    document.getElementById("file-info").style.display = "none";
  }

  let arhiv = [];

  function shraniScenarij() {
    const datum = document.getElementById("datum").value;
    const naslov = document.getElementById("naslov").value.trim();
    const tip = document.getElementById("tip").value;
    const jezik = document.getElementById("jezik").value.trim();
    const stanje = document.getElementById("stanje").value;

    if (!datum || !naslov || !jezik) {
      alert("Prosim, izpolnite vse obvezne podatke.");
      return;
    }
    // Za demo: Datoteko bomo samo shranili v arhiv kot objekt, brez upload-a (ni backend)
    let datotekaObjekt = null;
    if (izbranaDatoteka) {
      // Branje datoteke v Base64, da lahko damo povezavo (demo)
      const reader = new FileReader();
      reader.onload = function (e) {
        datotekaObjekt = {
          ime: izbranaDatoteka.name,
          vsebina: e.target.result,
          tip: izbranaDatoteka.type,
        };
        dodajVArhiv({
          datum,
          naslov,
          tip,
          jezik,
          stanje,
          datoteka: datotekaObjekt,
          avtor: prijavljen,
        });
        zapriModal();
      };
      reader.readAsDataURL(izbranaDatoteka);
    } else {
      dodajVArhiv({
        datum,
        naslov,
        tip,
        jezik,
        stanje,
        datoteka: null,
        avtor: prijavljen,
      });
      zapriModal();
    }
  }

  function dodajVArhiv(vnos) {
    arhiv.push(vnos);
    osveziTabelo();
  }

  function osveziTabelo() {
    const tbody = document.querySelector("#tabela tbody");
    tbody.innerHTML = "";
    arhiv.forEach((vnos, i) => {
      const tr = document.createElement("tr");

      // Datum
      const tdDatum = document.createElement("td");
      tdDatum.textContent = vnos.datum;
      tr.appendChild(tdDatum);

      // Naslov - klikljiv za modal z detajli
      const tdNaslov = document.createElement("td");
      const a = document.createElement("a");
      a.textContent = vnos.naslov;
      a.href = "#";
      a.className = "scenarij-link";
      a.onclick = (e) => {
        e.preventDefault();
        odpriPodrobnostiModal(i);
      };
      tdNaslov.appendChild(a);
      tr.appendChild(tdNaslov);

      // Tip
      const tdTip = document.createElement("td");
      tdTip.textContent = vnos.tip;
      tr.appendChild(tdTip);

      // Jezik
      const tdJezik = document.createElement("td");
      tdJezik.textContent = vnos.jezik;
      tr.appendChild(tdJezik);

      // Stanje
      const tdStanje = document.createElement("td");
      tdStanje.textContent = vnos.stanje;
      tr.appendChild(tdStanje);

      tbody.appendChild(tr);
    });
  }

  // Modal za podrobnosti scenarija
  function odpriPodrobnostiModal(index) {
    const vnos = arhiv[index];
    document.getElementById("podrobnostiNaslov").textContent = vnos.naslov;
    document.getElementById("podrobnostiDatum").textContent = vnos.datum;
    document.getElementById("podrobnostiTip").textContent = vnos.tip;
    document.getElementById("podrobnostiJezik").textContent = vnos.jezik;
    document.getElementById("podrobnostiStanje").textContent = vnos.stanje;
    document.getElementById("podrobnostiAvtor").textContent = vnos.avtor;
    const link = document.getElementById("podrobnostiLink");
    if (vnos.datoteka) {
      link.href = vnos.datoteka.vsebina;
      link.download = vnos.datoteka.ime;
      link.style.pointerEvents = "auto";
      link.style.color = "#2e77d0";
    } else {
      link.href = "#";
      link.style.pointerEvents = "none";
      link.style.color = "#999";
      link.textContent = "Ni datoteke";
    }
    document.getElementById("podrobnostiModal").style.display = "flex";
  }

  function zapriPodrobnostiModal() {
    document.getElementById("podrobnostiModal").style.display = "none";
  }

  // Prikaz strani
  function prikaziDomov() {
    skrijVse();
    document.getElementById("domov").style.display = "block";
  }

  function prikaziArhiv() {
    skrijVse();
    document.getElementById("arhiv").style.display = "block";
  }

  function skrijVse() {
    document.querySelectorAll(".content").forEach((el) => {
      el.style.display = "none";
    });
  }

  // Če je uporabnik že prijavljen v localStorage, prikažemo takoj
  window.onload = function () {
    const user = localStorage.getItem("prijavljen");
    if (user) {
      prijavljen = user;
      document.getElementById("login").style.display = "none";
      prikaziDomov();
    } else {
      document.getElementById("login").style.display = "flex";
    }
  };
</script>
</body>
</html>
